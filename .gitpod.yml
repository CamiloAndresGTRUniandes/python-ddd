# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  - name: Instalar Python
    init: > 
      pyenv install 3.10.7 -f &&
      pyenv local 3.10.7 &&
      gp sync-done bundle
  - name: Instalar dependencias
    init: gp sync-await bundle
    command: pip install --upgrade --no-cache-dir pip setuptools wheel && pip install --no-cache-dir wheel && pip install -r requirements.txt
  - name: Crear imagenes Docker
    init: > 
      docker build . -f Dockerfile -t companyname/flask &&
      gp sync-done images
  - name: Crear folder para datos, clientes, conectores y asigna permisos
    init: > 
      mkdir -p data/bookkeeper && 
      mkdir -p data/zookeeper && 
      mkdir -p data/mysql && 
      sudo chmod -R 777 data &&
      sudo chmod -R 777 connectors
  - name: Pull el Docker compose
    init: gp sync-await images
    command: docker-compose pull
  - name: Start services db
    init: >
      docker-compose --profile db up
  - name: Start services pulsar
    init: >
      docker-compose --profile pulsar up
  - name: Start services redis
    init: >
      docker-compose --profile redis up
  - name: start pulsar
    init: >
      docker-compose --profile pulsar up
  - init: echo "Configurando el entorno..."
    command: sleep 40 && 
  - name: update permissions gp sync-done set_timeout
    init: gp sync-await set_timeout
      sudo chmod -R 777 data && sudo chmod -R 777 connectors && gp sync-done update_permissions
  - name: Start companyname services
    init: gp sync-await update_permissions
    command: flask --app src/companyname/api run --debugger --no-reload
  
ports:
  - port: 2181
    onOpen: ignore
  - port: 8080
    onOpen: ignore
  - port: 6650
    onOpen: ignore
  - port: 2181
    onOpen: ignore
  - port: 6650
    onOpen: ignore


